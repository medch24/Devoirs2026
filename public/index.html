<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="portalTitle">Portail de Suivi des Devoirs</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/fr.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/ar.js"></script>
</head>
<body>

    <div class="container">
        <!-- Vue Principale (Accueil) -->
        <div id="home-view">
            <header class="main-header">
                <div class="language-selector-home">
                    <button id="lang-fr">Fran√ßais</button>
                    <button id="lang-ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
                </div>
                <h1 data-translate="portalTitle">Portail de Suivi des Devoirs</h1>
            </header>
            <main class="main-menu">
                <img src="https://lh3.googleusercontent.com/d/1lQ3Babrs3Wgv4rakVmkK0oCWcM0cTKPK" alt="Logo √âcole" id="home-logo">
                <button id="go-to-parent" class="role-button" data-translate="parentSpace">Espace Parent</button>
                <button id="go-to-teacher" class="role-button" data-translate="teacherSpace">Espace Enseignant</button>
                <div class="home-showcase-container">
                    <div id="sotw-showcase" class="student-of-the-week-showcase" style="display: none;"></div>
                    <div id="photos-row" class="photos-row">
                        <div id="potd-showcase" class="photo-of-the-day-showcase" style="display: none;">
                            <h2 class="potd-title" data-translate="potdTitle">üéâ F√©licitations ! üéâ</h2>
                            <img id="potd-image" src="" alt="Photo de f√©licitations" class="potd-image">
                            <p id="potd-message"></p>
                        </div>
                        <div id="photo2-showcase" class="photo-of-the-day-showcase" style="display: none;">
                            <h2 class="potd-title" data-translate="photo2Title">üåü Bravo ! üåü</h2>
                            <img id="photo2-image" src="" alt="Photo de c√©l√©bration 2" class="potd-image">
                            <p id="photo2-message"></p>
                        </div>
                        <div id="photo3-showcase" class="photo-of-the-day-showcase" style="display: none;">
                            <h2 class="potd-title" data-translate="photo3Title">üèÜ Excellent ! üèÜ</h2>
                            <img id="photo3-image" src="" alt="Photo de c√©l√©bration 3" class="potd-image">
                            <p id="photo3-message"></p>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Vue Espace Parent -->
        <div id="parent-selection-view" class="view" style="display: none;">
            <header>
                <button class="back-button">&larr;</button>
                <h1 data-translate="parentSpace">Espace Parent</h1>
            </header>
            <main class="parent-flow-main">
                <h2 class="section-title" data-translate="classSelectionTitle">1. Choisissez une classe</h2>
                <div id="class-buttons-container" class="class-buttons-container"></div>
                <h2 class="section-title" id="student-selection-title" data-translate="studentSelectionTitle" style="display: none;">2. Choisissez votre enfant</h2>
                <div id="student-grid-container" class="student-grid"></div>
                
                <!-- Section Contact Enseignants -->
                <div class="teacher-contact-section">
                    <h2 class="section-title" data-translate="contactTeachersTitle">üìß Contacter les Enseignants</h2>
                    
                    <!-- Badge de notification parent -->
                    <div id="parent-notification-badge" style="display: none; margin: 15px 0; padding: 12px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 8px; cursor: pointer;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 24px;">üîî</span>
                            <div>
                                <strong>Vous avez <span id="parent-unread-count">0</span> nouvelle(s) r√©ponse(s)</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.9em; color: #92400e;">Cliquez pour voir vos messages</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Historique des messages parent -->
                    <div id="parent-messages-history" style="display: none; margin: 20px 0;">
                        <h3 style="margin-bottom: 15px;">üì¨ Historique de vos messages</h3>
                        <div id="parent-messages-list"></div>
                        <button id="close-messages-history" class="role-button" style="margin-top: 15px; background: #6b7280;">Fermer</button>
                    </div>
                    
                    <div id="teachers-contact-grid" class="teachers-contact-grid"></div>
                </div>
            </main>
        </div>
        
        <!-- Vue Espace Enseignant - Connexion -->
        <div id="teacher-login-view" class="view" style="display: none;">
            <header>
                <button class="back-button">&larr;</button>
                <h1 data-translate="teacherLoginTitle">Acc√®s Enseignant</h1>
            </header>
            <main>
                <form id="teacher-login-form" class="login-form">
                    <input type="text" id="username" data-translate-placeholder="usernamePlaceholder" placeholder="Nom d'utilisateur" required>
                    <input type="password" id="password" data-translate-placeholder="passwordPlaceholder" placeholder="Mot de passe" required>
                    <button type="submit" data-translate="loginButton">Connexion</button>
                    <p id="login-error" class="error-message"></p>
                </form>
            </main>
        </div>

        <!-- Vue Tableau de Bord de l'√âl√®ve -->
        <div id="student-dashboard-view" class="view" style="display: none;">
            <header>
                <button class="back-button">&larr;</button>
                <h1 id="student-name-header"></h1>
            </header>
            <main>
                <div class="profile-summary">
                    <div class="student-info">
                        <img src="" alt="Photo √©l√®ve" class="student-photo">
                        <div class="star-rating" id="star-rating"></div>
                        <div id="daily-progress-note" class="daily-progress-note" aria-live="polite"></div>
                        <div class="student-of-week" id="student-of-week-banner" data-translate="studentOfTheWeek">√âl√®ve de la semaine</div>
                    </div>
                    <div class="weekly-stats">
                        <h3 class="stat-title">üìà <span data-translate="overallWeeklyProgress">Progression g√©n√©rale</span></h3>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="overall-progress-bar"></div>
                            <span id="overall-progress-text">0%</span>
                        </div>
                    </div>
                </div>
                
                <!-- Section √âvaluation G√©n√©rale -->
                <div id="general-evaluations-container"></div>
                
                <div class="dashboard-nav">
                    <button id="prev-day-btn" class="nav-arrow">&larr; <span data-translate="previousDay">Jour Pr√©c√©dent</span></button>
                    <h2 id="homework-date"></h2>
                    <button id="next-day-btn" class="nav-arrow"><span data-translate="nextDay">Jour Suivant</span> &rarr;</button>
                </div>
                <div class="homework-grid" id="homework-grid"></div>
            </main>
        </div>
        
        <!-- Vue Tableau de Bord Enseignant -->
        <div id="teacher-dashboard-view" class="view" style="display: none;">
            <header>
                <button class="back-button">&larr;</button>
                <h1 data-translate="teacherDashboardTitle">Tableau de Bord Enseignant</h1>
                <button id="view-messages-btn" class="messages-button" style="display: none;">
                    üì¨ <span data-translate="messagesButton">Messages</span>
                    <span id="unread-count" class="unread-badge" style="display: none;">0</span>
                </button>
            </header>
            <main>
                <div id="admin-upload-section" class="upload-section" style="display: none;">
                    <h3 class="section-title">üìÖ <span data-translate="updateSchedule">Mettre √† jour le planning</span></h3>
                    <input type="file" id="excel-file-input" accept=".xlsx, .xls, .xlsb, .csv">
                    <button id="upload-excel-btn" class="role-button" data-translate="uploadButton">Charger et Mettre √† jour</button>
                    <p id="upload-status"></p>
                </div>
                <div class="teacher-main-content">
                    <h2 class="section-title" data-translate="teacherSelectTitle">1. Choisissez votre nom</h2>
                    <div id="teacher-icons-container" class="teacher-icons-container"></div>
                    <h2 class="section-title" id="week-selection-title" style="display: none;">2. <span data-translate="weekSelectionTitle">Choisissez une semaine</span></h2>
                    <div id="week-buttons-container" class="week-buttons-container"></div>
                    <h2 class="section-title" id="homework-cards-title" style="display: none;">3. <span data-translate="homeworkToEvaluate">Choisissez un devoir √† √©valuer</span></h2>
                    <div id="homework-cards-container" class="homework-cards-container"></div>
                    <div id="teacher-evaluation-section" style="display: none;">
                        <h2 class="section-title">4. <span data-translate="studentEvaluationTitle">√âvaluez les √©l√®ves</span></h2>
                        <div id="teacher-table-container"></div>
                    </div>
                </div>
                
                <!-- Section Messages Enseignant -->
                <div id="teacher-messages-container" style="display: none; margin-top: 30px;"></div>
                
                <!-- MODIFICATION: Ajout d'un champ pour le commentaire -->
                <div id="admin-photo-section" class="upload-section" style="display: none; margin-top: 30px; background-color: #e9f5ff;">
                    <h3 class="section-title">üñºÔ∏è <span data-translate="adminPhotoTitle">Ajouter une Photo de F√©licitations</span></h3>
                    <input type="text" id="photo-url-input" placeholder="Collez le lien de l'image ici (lh3.googleusercontent.com)...">
                    <input type="text" id="photo-comment-input" placeholder="Ajoutez un commentaire (optionnel)...">
                    <button id="submit-photo-btn" class="role-button" data-translate="saveButton">Enregistrer</button>
                    <p id="photo-status"></p>
                </div>
                
                <!-- Photo de c√©l√©bration 2 -->
                <div id="admin-photo2-section" class="upload-section" style="display: none; margin-top: 30px; background-color: #fff9e6;">
                    <h3 class="section-title">üåü <span data-translate="adminPhoto2Title">Ajouter une Photo de C√©l√©bration 2</span></h3>
                    <input type="text" id="photo2-url-input" placeholder="Collez le lien de l'image ici (lh3.googleusercontent.com)...">
                    <input type="text" id="photo2-comment-input" placeholder="Ajoutez un commentaire (optionnel)...">
                    <button id="submit-photo2-btn" class="role-button" data-translate="saveButton">Enregistrer</button>
                    <p id="photo2-status"></p>
                </div>
                
                <!-- Photo de c√©l√©bration 3 -->
                <div id="admin-photo3-section" class="upload-section" style="display: none; margin-top: 30px; background-color: #f0fff0;">
                    <h3 class="section-title">üèÜ <span data-translate="adminPhoto3Title">Ajouter une Photo de C√©l√©bration 3</span></h3>
                    <input type="text" id="photo3-url-input" placeholder="Collez le lien de l'image ici (lh3.googleusercontent.com)...">
                    <input type="text" id="photo3-comment-input" placeholder="Ajoutez un commentaire (optionnel)...">
                    <button id="submit-photo3-btn" class="role-button" data-translate="saveButton">Enregistrer</button>
                    <p id="photo3-status"></p>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal de connexion/inscription parent -->
    <div id="parent-auth-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal-auth">&times;</span>
            <h2 class="modal-title" id="auth-modal-title" data-translate="parentLoginTitle">Connexion Parent</h2>
            
            <!-- Formulaire de connexion -->
            <form id="parent-login-form" style="display: block;">
                <label for="login-phone" data-translate="phoneLabel">Num√©ro de t√©l√©phone :</label>
                <input type="tel" id="login-phone" required placeholder="Ex: 20123456">
                
                <label for="login-password" data-translate="passwordPlaceholder">Mot de passe :</label>
                <input type="password" id="login-password" required placeholder="Votre mot de passe">
                
                <button type="submit" class="role-button" data-translate="loginButton">Connexion</button>
                <p id="login-status"></p>
                
                <p style="text-align: center; margin-top: 15px;">
                    <span data-translate="noAccountYet">Pas encore de compte ?</span>
                    <a href="#" id="show-register-form" style="color: #667eea; font-weight: 600;">Cr√©er un compte</a>
                </p>
            </form>
            
            <!-- Formulaire d'inscription -->
            <form id="parent-register-form" style="display: none;">
                <label for="register-firstname" data-translate="firstNameLabel">Pr√©nom :</label>
                <input type="text" id="register-firstname" required placeholder="Votre pr√©nom">
                
                <label for="register-lastname" data-translate="lastNameLabel">Nom :</label>
                <input type="text" id="register-lastname" required placeholder="Votre nom de famille">
                
                <label for="register-phone" data-translate="phoneLabel">Num√©ro de t√©l√©phone :</label>
                <input type="tel" id="register-phone" required placeholder="Ex: 20123456">
                
                <label for="register-password" data-translate="passwordPlaceholder">Mot de passe :</label>
                <input type="password" id="register-password" required placeholder="Choisissez un mot de passe">
                
                <label for="register-password-confirm" data-translate="confirmPasswordLabel">Confirmer le mot de passe :</label>
                <input type="password" id="register-password-confirm" required placeholder="Confirmez votre mot de passe">
                
                <button type="submit" class="role-button" data-translate="registerButton">Cr√©er mon compte</button>
                <p id="register-status"></p>
                
                <p style="text-align: center; margin-top: 15px;">
                    <span data-translate="alreadyHaveAccount">D√©j√† un compte ?</span>
                    <a href="#" id="show-login-form" style="color: #667eea; font-weight: 600;">Se connecter</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Modal pour contacter un enseignant -->
    <div id="contact-teacher-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="modal-title" data-translate="sendMessageTitle">Envoyer un message</h2>
            <div class="teacher-modal-info">
                <img id="modal-teacher-photo" src="" alt="Photo enseignant" class="modal-teacher-photo">
                <div>
                    <h3 id="modal-teacher-name"></h3>
                    <p id="modal-teacher-subjects"></p>
                </div>
            </div>
            <div id="parent-info-display" style="margin: 15px 0; padding: 10px; background: #f0f9ff; border-radius: 8px;">
                <p><strong>Connect√© en tant que :</strong> <span id="logged-parent-name"></span></p>
                <p><strong>T√©l√©phone :</strong> <span id="logged-parent-phone"></span></p>
            </div>
            <form id="contact-teacher-form">
                <label for="message-content" data-translate="messageLabel">Votre message :</label>
                <textarea id="message-content" rows="6" required placeholder="√âcrivez votre message ici..."></textarea>
                
                <button type="submit" class="role-button" data-translate="sendButton">Envoyer</button>
                <p id="message-status"></p>
            </form>
        </div>
    </div>

    <!-- Vue Messages Enseignant (dans le dashboard enseignant) -->
    <div id="teacher-messages-view" class="view" style="display: none;">
        <header>
            <button class="back-button">&larr;</button>
            <h1 data-translate="teacherMessagesTitle">Mes Messages</h1>
        </header>
        <main class="messages-main">
            <div id="messages-container" class="messages-container"></div>
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>
